<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body {
            font-family: sans-serif
        }
    </style>
</head>
<body>
    <h1>Analog klokke</h1>
    <select id="select">
    </select><br><br>
    <canvas id="canvas"></canvas> 
<script src="timezones.js"></script>
<script>
    var selectEl=document.getElementById("select")
    
    selectEl.innerHTML+="<option value=" + timezones[43].offset + " selected disabled hidden>" + timezones[43].offset + " " + timezones[43].name + "</option>"
    for (var i=0; i<timezones.length; i++) {
        selectEl.innerHTML+="<option value" + timezones[i].offset + ">" + timezones[i].offset + " " + timezones[i].name + "</option>"
    }
    
    
    
    var canvas = document.querySelector("canvas")
    canvas.width = 410
    canvas.height = 410
    var ctx = canvas.getContext("2d")   
    
    var origox = canvas.width/2
    var origoy = canvas.height/2
    var realisticSecMovement=0
    var m=0
    var n=0
        
    klokkefunk();
    setInterval(klokkefunk,10)
    function klokkefunk() {
        ctx.clearRect(0,0,canvas.width,canvas.height)
        ctx.lineWidth=3
        
        ctx.beginPath()
        ctx.arc(origox, origoy, 200, 0, Math.PI*2)
        ctx.stroke()
        
        for (var i = 0; i<12; i++) {
            ctx.lineWidth = 3
            j=i
            if (j+3>12) {
                j=j-12
            }
            
            var v = i*2*Math.PI/12
            ctx.textAlign="center"
            ctx.textBaseline="middle"
            ctx.font="34px 'century gothic'"
            ctx.fillText(j+3, origox+170*Math.cos(v),origoy+170*Math.sin(v))
        }
            
        for (var i=0; i<60; i++) {
            var v = i*2*Math.PI/60
            k=193
            ctx.lineWidth=1
            if (i%5===0) {
                k=190
                ctx.lineWidth=2
            }
            
            ctx.beginPath()
            ctx.moveTo(origox+k*Math.cos(v),origoy+k*Math.sin(v))
            ctx.lineTo(origox+200*Math.cos(v),origoy+200*Math.sin(v))
            ctx.stroke()  
        }
        
        var date = new Date()
        var offset = date.getTimezoneOffset()/60
        var newHour= Number(selectEl.value[3] + ""  + selectEl.value[4]  + selectEl.value[5])
        if (isNaN(newHour)) {
            newHour=0
        }
        
        newHour= newHour+offset
        newMin=Number(selectEl.value[3] + selectEl.value[7] +"" + selectEl.value[8])
        if (isNaN(newMin)) {
            newMin=0
        }
        
        var milliSec = date.getMilliseconds()
        
        if (milliSec>980 && m===0){
            m=1
        }
        
        if (m===1) {
            realisticSecMovement+=1/3
        }else {
            realisticSecMovement=0
        }
        
        if(realisticSecMovement>2/3 || milliSec<100) {
            m=0
            realisticSecMovement=0
        }

        
        var sec = date.getSeconds()+realisticSecMovement
        var min = date.getMinutes() + sec/60+newMin
        var hours = date.getHours()+min/60+newHour
        
        var v = hours*2*Math.PI/12 - Math.PI/2
        ctx.beginPath()
        ctx.lineWidth = 3
        ctx.moveTo(origox-15*Math.cos(v),origoy-15*Math.sin(v))
        ctx.lineTo(origox+120*Math.cos(v),origoy+120*Math.sin(v))
        ctx.stroke()
        
        var v = min*2*Math.PI/60 - Math.PI/2
        ctx.beginPath()
        ctx.lineWidth =3
        ctx.moveTo(origox-15*Math.cos(v),origoy-15*Math.sin(v))
        ctx.lineTo(origox+185*Math.cos(v),origoy+185*Math.sin(v))
        ctx.stroke()
        
        var v = sec*2*Math.PI/60 - Math.PI/2
        ctx.beginPath()
        ctx.lineWidth = 2
        ctx.strokeStyle="red"
        ctx.moveTo(origox-15*Math.cos(v),origoy-15*Math.sin(v))
        ctx.lineTo(origox+185*Math.cos(v),origoy+185*Math.sin(v))
        ctx.stroke()
        
        ctx.strokeStyle="black"
        
        ctx.beginPath()
        ctx.arc(origox, origoy, 3, 0, Math.PI*2)
        ctx.fill()
    }
    
</script>
</body>
</html>
